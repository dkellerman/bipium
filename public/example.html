<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sakura.css/css/sakura.css"
    />
    <title>Basic metronome embedded example</title>
    <script src="./dist/bipium-core.js"></script>

    <script>
      window.onload = function () {
        window.m = Bipium.createMetronome({
          workerUrl: './dist/worker.js',
          bpm: 80,
          subDivs: 1,
        });

        window.viz = new Bipium.Visualizer({ metronome: m });

        const count = document.getElementById('count');
        const progress = document.getElementById('progress');

        requestAnimationFrame(function redraw() {
          viz.update();
          count.innerText = viz.count ? viz.count.join('-') : '';
          progress.style.width = `${(viz.progress || 0) * 100}%`;
          requestAnimationFrame(redraw);
        });
      };
    </script>
  </head>

  <body>
    <div id="root">
      <h2>Basic metronome embedded example</h2>

      <p style="display: flex; align-items: center; gap: 0.5rem">
        <label for="bpm-input" style="margin: 0">BPM:</label>
        <input
          id="bpm-input"
          type="number"
          value="80"
          min="20"
          max="300"
          step="1"
          style="width: 4.5em; margin: 0; border: 0; box-shadow: none"
          onchange="m.update({ bpm: parseFloat(event.target.value) || 80 })"
        />
      </p>

      <label for="subdiv-toggle" style="display: inline-flex; align-items: center; gap: 0.5rem">
        <input
          id="subdiv-toggle"
          type="checkbox"
          style="margin: 0"
          onchange="m.update({ subDivs: event.target.checked ? 4 : 1 })"
        />
        Play sub divisions
      </label>

      <p>
        <button onclick="m.start(); viz.start();">Start</button>
        <button onclick="m.stop(); viz.stop()">Stop</button>
      </p>

      <!-- visualizer -->
      <div style="width: 300px; background: #eee">
        <div id="progress" style="background: green; width: 0; height: 10px"></div>
        <div id="count" style="text-align: center; font-size: 40px; background: white"></div>
      </div>

      <p style="margin-top: 2rem; font-size: 0.75em">
        <a
          href="https://github.com/dkellerman/bipium/blob/master/public/example.html"
          target="_blank"
          rel="noreferrer"
          >View source</a
        >
      </p>
    </div>
  </body>
</html>
